# 日本FX特化YouTube分析システム - 変更点一覧

## 📋 概要
既存の`analysegas.gs`ファイルが見つからなかったため、仕様に基づいて完全な新規実装を作成しました。

## 🆕 新規実装機能

### 1. 日本FX特化の抽出ロジック
- **関数**: `searchChannelsForTerm_jpfx()`, `calculateFxScore_jpfx()`
- **機能**: 
  - 登録者数1000人以上限定のフィルタリング
  - FXキーワードベースのスコアリング（28種類のFX用語）
  - 日本語判定とヒューリスティック分析
  - 英語主体チャンネルの減点システム

### 2. チャンネルURL自動生成
- **関数**: `generateChannelUrl()`
- **機能**: 
  - @ハンドル優先のURL生成
  - `https://www.youtube.com/@{customUrl}` または `https://www.youtube.com/channel/{channelId}`
  - 「発見チャンネル」シートの「チャンネルURL」列に自動出力

### 3. シートスキーマの統一
- **変更されたシート**: 「発見チャンネル」
- **新しい列構成**:
  ```
  チャンネルID | チャンネル名 | チャンネルURL | 登録者数 | 総再生数 | 
  動画本数 | 国 | FX関連スコア | 直近投稿(JST) | 直近投稿から日数 | 
  トップ動画タイトル | トップ動画URL | トップ動画再生数 | PopularityScore
  ```

### 4. 簡易モード機能
- **関数**: `toggleSimpleMode()`, `applySimpleMode()`
- **機能**: 
  - 表示タブの制限（検索語・発見チャンネル・分析対象チャンネル・ダッシュボード・設定・ログのみ）
  - 内部処理用シート（動画一覧・日次スナップ等）の非表示化
  - シート順序の自動調整

### 5. 自動ダッシュボード・グラフ生成
- **関数**: `seedDashboard()`, `createSubscribersChart()`, `createVPDChart()`, `createTrendChart()`, `createHeatmapChart()`
- **生成グラフ**:
  1. 上位20チャンネルの登録者数（棒グラフ）
  2. 上位20チャンネルのVPD（動画あたり再生数）（棒グラフ）
  3. 分析対象チャンネルの登録者推移（折れ線グラフ）
  4. 投稿時間帯分析（テーブル形式ヒートマップ）

### 6. AI質問機能（自然言語Q&A）
- **関数**: `ASK_AI()`, `callClaudeAPI()`, `callOpenAIAPI()`
- **機能**: 
  - カスタム関数 `=ASK_AI(prompt, [範囲])`
  - Anthropic Claude API優先、OpenAI GPT予備対応
  - 範囲指定による柔軟なデータ分析
  - ダッシュボード要約の自動生成

## 🔧 新規メニュー項目

### メインメニュー「🎯 日本FX YouTube分析」
- `0. 初期セットアップガイド` → `showSetupGuide()`
- `1. 競合発見（日本FX特化）` → `discoverChannels()`
- `2a. 全取得チャンネル詳細更新` → `updateAllChannelDetails()`
- `2b. 人気順で抽出` → `extractTopChannels()`
- `3. メトリクス取得（低負荷）` → `fetchPublicMetricsLowQuota()`
- `4. 詳細動画一覧更新` → `updateVideoDetails()`
- `5. 日次スナップショット` → `snapshotPublicMetrics()`
- `9. ダッシュボード初期化` → `seedDashboard()`
- `ダッシュボード再生成` → `regenerateDashboard()`
- `AIに要約してもらう（ダッシュボード）` → `generateAISummary()`
- `簡易モード ON/OFF` → `toggleSimpleMode()`
- `環境診断（Health Check）` → `healthCheck()`

## 📊 シート構成

### 表示シート（簡易モード時）
1. **検索語** - FXキーワードの管理
2. **発見チャンネル** - 発見された全チャンネルの詳細
3. **分析対象チャンネル** - 選定された分析対象
4. **ダッシュボード** - 統計とグラフの表示
5. **設定** - APIキーと設定値
6. **ログ** - 実行履歴とエラーログ

### 内部処理用シート（通常時のみ表示）
7. **動画一覧** - 詳細動画データ
8. **日次スナップ** - 日別メトリクス履歴
9. **派生KPI** - 計算済み指標
10. **タイトル分析** - タイトル分析結果
11. **チャンネルスコア** - スコアリング結果
12. **曜日×時間帯分析** - 投稿パターン分析
13. **コメント関連** - コメント分析

## ⚙️ 設定項目の拡張

「設定」シートの新規項目：
- `APIKEY` - YouTube Data API v3 キー
- `ANTHROPIC_API_KEY` - Claude API キー（AI機能用）
- `OPENAI_API_KEY` - OpenAI API キー（予備）
- `MAX_CHANNELS` - 最大取得チャンネル数（既定: 500）
- `MIN_SUBSCRIBERS` - 最小登録者数（既定: 1000）
- `FX_SCORE_THRESHOLD` - FX関連判定しきい値（既定: 2）
- `SIMPLE_MODE` - 簡易モード設定（ON/OFF）

## 🛠️ ユーティリティ関数

### 新規追加
- `exponentialBackoff()` - APIリトライ機能
- `formatJST()` - 日本時間フォーマット
- `logMessage()` - ログ出力管理
- `getSettings()` - 設定値取得
- `updateSetting()` - 設定値更新
- `healthCheck()` - 環境診断
- `setupTriggers()` - トリガー自動設定

### データ処理
- `getLatestVideoInfo()` - 最新動画情報取得
- `calculatePopularityScore()` - 人気度スコア計算
- `updateChannelMetrics()` - チャンネルメトリクス更新
- `getChannelVideos()` - チャンネル動画一覧取得

## 🔒 セキュリティ・安定化対応

- APIクォータ節約のための待機処理
- エラーハンドリングの強化
- ログレベル管理（INFO/WARN/ERROR）
- 非公開・0・NaNチャンネルの除外処理
- APIキー未設定時の適切なエラーメッセージ

## 📈 パフォーマンス最適化

- バッチ処理による効率化
- ページネーション対応
- 重複チャンネル排除
- 適切な待機時間設定
- メモリ効率を考慮したデータ構造

## 🌐 国際化対応

- 全UI・コメント・メッセージの日本語化
- JST時間表示
- 日本語文字判定ロジック
- regionCode='JP', relevanceLanguage='ja'設定

## ⏰ 自動化対応

- 日次実行トリガー（メトリクス更新）
- 週次実行トリガー（競合発見）
- 手動トリガー設定機能
- バックグラウンド処理対応