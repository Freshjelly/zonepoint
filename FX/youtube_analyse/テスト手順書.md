# 日本FX特化YouTube分析システム - テスト手順書

## 📋 事前準備

### 1. 必要な権限・設定
- [ ] Google Cloud Console でYouTube Data API v3を有効化
- [ ] GAS エディタでAdvanced Google Services → YouTube Data API v3を追加
- [ ] YouTube Data API v3のAPIキーを取得
- [ ] （オプション）Anthropic Claude API またはOpenAI APIキーを取得

### 2. 初期セットアップ
1. GASエディタで`analysegas.gs`をインポート
2. 「実行」→「onOpen」を実行してメニューを表示
3. 「0. 初期セットアップガイド」を実行して手順を確認
4. 「設定」シートのAPIKEY行にYouTube Data API v3キーを入力
5. （オプション）「設定」シートのANTHROPIC_API_KEY行にClaude APIキーを入力

## 🧪 基本機能テスト

### テスト1: 初期化とシート作成
**目的**: 必要なシートが正しく作成されることを確認

**手順**:
1. 新しいGoogleスプレッドシートを作成
2. GASエディタで`analysegas.gs`を作成・保存
3. 「実行」→「onOpen」を実行

**期待結果**:
- [ ] 以下のシートが作成される：
  - 検索語、発見チャンネル、分析対象チャンネル、ダッシュボード、設定、ログ
  - 動画一覧、日次スナップ、派生KPI、タイトル分析、チャンネルスコア、曜日×時間帯分析、コメント関連
- [ ] 各シートにヘッダー行が設定される
- [ ] 「検索語」シートに初期FXキーワードが入力される
- [ ] メニュー「🎯 日本FX YouTube分析」が表示される

### テスト2: 環境診断
**目的**: APIキー設定と環境が正しく動作することを確認

**手順**:
1. メニュー「環境診断（Health Check）」を実行

**期待結果**:
- [ ] YouTube Data API キーが設定済みと表示される
- [ ] YouTube Advanced Service有効と表示される
- [ ] Anthropic API キー未設定の場合は警告表示（正常）
- [ ] 問題がある場合は具体的なエラー内容が表示される

### テスト3: 検索語設定
**目的**: FX関連検索語が適切に設定できることを確認

**手順**:
1. 「検索語」シートを開く
2. 以下のキーワードが設定されていることを確認：
   ```
   FX, 為替, ドル円, テクニカル分析, 移動平均, RSI, MACD, 
   ボリンジャー, フィボ, サポレジ, スキャル, デイトレ
   ```
3. 必要に応じて追加キーワードを入力

**期待結果**:
- [ ] 初期キーワードが正しく設定されている
- [ ] 新しいキーワードを追加可能

## 🔍 競合発見機能テスト

### テスト4: 日本FX特化チャンネル発見
**目的**: 1000人以上のFX関連チャンネルが正しく発見されることを確認

**手順**:
1. メニュー「1. 競合発見（日本FX特化）」を実行
2. 処理完了まで待機（5-10分程度）
3. 「発見チャンネル」シートを確認

**期待結果**:
- [ ] 登録者数1000人以上のチャンネルのみが表示される
- [ ] 「チャンネルURL」列が正しく設定される（@ハンドル優先）
- [ ] 「FX関連スコア」が2以上のチャンネルのみが含まれる
- [ ] 明らかにFX無関係のチャンネル（ゲーム実況など）が除外される
- [ ] 日本語チャンネルが中心となっている
- [ ] 「ログ」シートに実行履歴が記録される

**検証ポイント**:
```
チャンネルURL形式の確認:
- @ハンドルがある場合: https://www.youtube.com/@ハンドル名
- @ハンドルがない場合: https://www.youtube.com/channel/チャンネルID

FX関連性の確認:
- チャンネル名や説明にFXキーワードが含まれている
- 明らかに無関係なチャンネル（料理、ゲームなど）が除外されている
```

### テスト5: 人気順抽出
**目的**: 発見チャンネルから上位チャンネルが正しく抽出されることを確認

**手順**:
1. テスト4が完了していることを確認
2. メニュー「2b. 人気順で抽出」を実行
3. 「分析対象チャンネル」シートを確認

**期待結果**:
- [ ] 上位20件のチャンネルが抽出される
- [ ] PopularityScoreの高い順に並んでいる
- [ ] チャンネルID、チャンネル名、チャンネルURL、メモ欄が設定される
- [ ] メモ欄に「人気上位X位」が記録される

## 📊 データ取得・更新テスト

### テスト6: メトリクス取得（低負荷）
**目的**: 基本的なチャンネルメトリクスが取得できることを確認

**手順**:
1. テスト5が完了していることを確認
2. メニュー「3. メトリクス取得（低負荷）」を実行
3. 「発見チャンネル」シートの内容を確認

**期待結果**:
- [ ] 分析対象チャンネルの登録者数、総再生数、動画本数が更新される
- [ ] 最新動画情報（タイトル、URL、再生数、投稿日）が取得される
- [ ] 「直近投稿から日数」が計算される
- [ ] エラーが発生した場合はログに記録される

### テスト7: 詳細動画一覧更新
**目的**: チャンネルの動画詳細が取得できることを確認

**手順**:
1. メニュー「4. 詳細動画一覧更新」を実行
2. 「動画一覧」シートを確認

**期待結果**:
- [ ] 各分析対象チャンネルの最新10本の動画情報が取得される
- [ ] チャンネルID、動画ID、タイトル、投稿日、再生数、いいね数、コメント数が設定される
- [ ] 動画説明の冒頭200文字が取得される

### テスト8: 日次スナップショット
**目的**: 日別のメトリクス履歴が記録されることを確認

**手順**:
1. メニュー「5. 日次スナップショット」を実行
2. 「日次スナップ」シートを確認

**期待結果**:
- [ ] 実行日の日付で各チャンネルのメトリクスが記録される
- [ ] 日付、チャンネルID、登録者数、総再生数、動画数が保存される
- [ ] 既存データに追加される形で記録される

## 📈 ダッシュボード・グラフテスト

### テスト9: ダッシュボード初期化
**目的**: グラフが正しく生成されることを確認

**手順**:
1. テスト6-8が完了していることを確認
2. メニュー「9. ダッシュボード初期化」を実行
3. 「ダッシュボード」シートを確認

**期待結果**:
- [ ] 以下の統計値が更新される：
  - 最終更新日時
  - 総発見チャンネル数
  - 分析対象数
  - 平均登録者数
- [ ] 4つのグラフが生成される：
  - 上位20チャンネル登録者数（棒グラフ）
  - 上位20チャンネルVPD（棒グラフ）
  - 登録者推移（折れ線グラフ）
  - 投稿時間帯分析（テーブル）

### テスト10: ダッシュボード再生成
**目的**: グラフの重複生成がされないことを確認

**手順**:
1. テスト9が完了していることを確認
2. メニュー「ダッシュボード再生成」を実行
3. 「ダッシュボード」シートのグラフ数を確認

**期待結果**:
- [ ] グラフが重複して作成されない
- [ ] 既存グラフが更新される
- [ ] グラフ数は4つのまま維持される

## 🧠 AI機能テスト

### テスト11: AI質問機能（APIキー設定時のみ）
**目的**: AI質問機能が正しく動作することを確認

**前提条件**:
- Anthropic API キーまたはOpenAI API キーが設定されている

**手順**:
1. 「ダッシュボード」シートの空いているセルに以下を入力：
   ```
   =ASK_AI("主要な伸びているチャンネルは？")
   ```
2. Enterキーを押して実行
3. 結果を確認

**期待結果**:
- [ ] 日本語で有用な回答が返される
- [ ] 発見チャンネルの内容に基づいた分析結果が表示される
- [ ] APIキー未設定時は適切なエラーメッセージが表示される

### テスト12: AI要約生成
**目的**: ダッシュボードのAI要約が生成されることを確認

**手順**:
1. メニュー「AIに要約してもらう（ダッシュボード）」を実行
2. 「ダッシュボード」シートのAI要約セクションを確認

**期待結果**:
- [ ] 「主要トレンド」セルにAI生成の要約が表示される
- [ ] 3-4行程度の簡潔な分析結果が得られる
- [ ] 登録者数、投稿頻度、人気動画などの観点が含まれる

## 🎛️ UI・モード切替テスト

### テスト13: 簡易モード切替
**目的**: 簡易モードの切り替えが正しく動作することを確認

**手順**:
1. 初期状態でのシート表示を確認
2. メニュー「簡易モード ON/OFF」を実行
3. シートタブの表示・非表示を確認
4. 再度メニュー「簡易モード ON/OFF」を実行
5. シートタブが元に戻ることを確認

**期待結果**:
- [ ] 簡易モードON時：指定の6シートのみ表示
  - 検索語、発見チャンネル、分析対象チャンネル、ダッシュボード、設定、ログ
- [ ] 内部処理用シートが非表示になる
- [ ] 簡易モードOFF時：全シートが表示される
- [ ] シート順序が適切に調整される

### テスト14: 初期セットアップガイド
**目的**: セットアップガイドが適切に表示されることを確認

**手順**:
1. メニュー「0. 初期セットアップガイド」を実行
2. 表示されるダイアログの内容を確認

**期待結果**:
- [ ] 必要な設定手順が日本語で表示される
- [ ] API有効化手順が含まれる
- [ ] 初回実行手順が含まれる
- [ ] わかりやすい説明になっている

## 🔧 エラーハンドリング・制約テスト

### テスト15: APIキー未設定時の動作
**目的**: APIキー未設定時に適切なエラー処理されることを確認

**手順**:
1. 「設定」シートのAPIKEYを空にする
2. メニュー「1. 競合発見（日本FX特化）」を実行

**期待結果**:
- [ ] 適切なエラーメッセージが表示される
- [ ] アプリケーションがクラッシュしない
- [ ] ログにエラーが記録される

### テスト16: API制限・エラー時のリトライ
**目的**: APIエラー時のリトライ機能が動作することを確認

**手順**:
1. 短時間で複数回の処理を実行してAPIクォータを消費
2. ログでリトライの動作を確認

**期待結果**:
- [ ] exponentialBackoff機能によりリトライが実行される
- [ ] リトライ回数と待機時間が適切
- [ ] 最終的にエラーとなる場合は適切に処理される

### テスト17: データ制約テスト
**目的**: 各種制約が正しく適用されることを確認

**検証ポイント**:
- [ ] 登録者数1000人未満のチャンネルが除外される
- [ ] FX関連スコアがしきい値以下のチャンネルが除外される
- [ ] 最大取得チャンネル数が制限される（設定値：500）
- [ ] 非公開・無効なチャンネルが適切に除外される

## ✅ 受け入れ基準チェック

### 必須要件の確認
- [ ] 「発見チャンネル」に"チャンネルURL"列が追加され、@ハンドル優先でURLが入る
- [ ] 登録者数1000人未満または非公開のチャンネルは一覧に出ない
- [ ] 明らかにFX無関係（ゲーム実況など）はFX関連スコアにより除外される
- [ ] ダッシュボードに4種のグラフが自動生成され、再実行で二重作成されない
- [ ] 簡易モードONで、指定タブ以外が非表示になる。OFFで復帰
- [ ] `=ASK_AI("主要な伸びているチャンネルは？")` が日本語で有用な要約を返す（APIキー設定時）
- [ ] すべてのUI文言・コメントは日本語
- [ ] 初回実行でセットアップ手順がわかる

## 📅 推奨テストスケジュール

### Phase 1: 基本機能（1-2時間）
- テスト1-5: 初期化〜競合発見

### Phase 2: データ取得（30-60分）
- テスト6-8: メトリクス取得〜スナップショット

### Phase 3: 可視化（30分）
- テスト9-10: ダッシュボード生成

### Phase 4: AI機能（30分）※APIキー設定済みの場合
- テスト11-12: AI質問〜要約生成

### Phase 5: UI・エラーハンドリング（30分）
- テスト13-17: モード切替〜制約テスト

## 🚨 既知の制約・注意点

1. **YouTube API制限**
   - 1日のAPIクォータ制限により大量処理は制限される
   - 地域判定（国）の精度には限界がある

2. **FX関連判定の精度**
   - キーワードベースのため、誤検出の可能性がある
   - 英語チャンネルの判定精度には限界がある

3. **AI機能**
   - 外部API（Anthropic/OpenAI）の可用性に依存
   - APIキー設定が必要

4. **パフォーマンス**
   - 大量チャンネルの処理には時間がかかる
   - 定期実行にはトリガー設定が必要

## 📞 トラブルシューティング

### よくある問題と解決方法

**Q: 「競合発見」でチャンネルが見つからない**
A: 以下を確認してください：
- YouTube Data API v3キーが正しく設定されているか
- Advanced Google ServicesでYouTube Data API v3が有効化されているか
- APIクォータが残っているか

**Q: グラフが表示されない**
A: 以下を確認してください：
- 発見チャンネルにデータが存在するか
- ダッシュボード初期化が正常完了したか
- シートの範囲に十分なデータがあるか

**Q: AI機能が動作しない**
A: 以下を確認してください：
- ANTHROPIC_API_KEYまたはOPENAI_API_KEYが設定されているか
- APIキーが有効で、クォータが残っているか
- 外部APIへのアクセスが許可されているか