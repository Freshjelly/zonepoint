# YouTube分析ツール - 日本FX特化統合版 セットアップ手順

## 🎯 概要
このツールは既存の「YouTube チャンネル分析ツール - 統合版」に日本FX特化機能を統合した完全版です。
- 日本のFX関連チャンネル自動発見（1000人以上限定）
- チャンネル・動画・コメントの包括分析
- 自動ダッシュボード生成（グラフ付き）
- AI質問機能（Claude/OpenAI対応）
- 簡易モードによるUI簡素化

## 📋 事前準備

### 必要なAPIとアカウント

#### 1. Google Cloud Platform （必須）
- [Google Cloud Console](https://console.cloud.google.com/) アカウント
- プロジェクトの作成または既存プロジェクトの使用
- YouTube Data API v3の有効化
- APIキーの生成

#### 2. AI機能用API（オプション）
**Anthropic Claude API（推奨）**
- [Anthropic Console](https://console.anthropic.com/) アカウント作成
- APIキーの生成
- 推奨モデル: claude-3-5-sonnet-20241022

**または OpenAI API（代替）**
- [OpenAI Platform](https://platform.openai.com/) アカウント作成  
- APIキーの生成
- 推奨モデル: gpt-4

## 🚀 セットアップ手順

### Step 1: Google Cloud Platform設定

#### 1-1. プロジェクト作成・選択
1. [Google Cloud Console](https://console.cloud.google.com/) にログイン
2. 既存プロジェクトを選択するか、「新しいプロジェクトを作成」をクリック
3. プロジェクト名を入力（例: "fx-youtube-analyzer"）
4. プロジェクトを作成・選択

#### 1-2. YouTube Data API v3の有効化
1. 左側のナビゲーションメニューから「**APIs & Services**」→「**Library**」
2. 検索ボックスに「YouTube Data API v3」と入力
3. 「**YouTube Data API v3**」を選択
4. 「**有効にする**」ボタンをクリック

#### 1-3. APIキーの作成
1. 「**APIs & Services**」→「**認証情報**」に移動
2. 「**+ 認証情報を作成**」→「**APIキー**」をクリック
3. 生成されたAPIキーをコピーして安全に保存
4. （推奨）「**APIキーを制限**」をクリックして以下を設定：
   - **アプリケーションの制限**: なし（またはHTTPリファラー）
   - **API の制限**: 「YouTube Data API v3」のみ選択
5. 「**保存**」をクリック

### Step 2: Google Apps Script設定

#### 2-1. スプレッドシート作成
1. [Google Sheets](https://sheets.google.com/) で新しいスプレッドシートを作成
2. わかりやすい名前に変更（例: "日本FX YouTube分析ツール"）

#### 2-2. Apps Script プロジェクト作成
1. スプレッドシートで「**拡張機能**」→「**Apps Script**」をクリック
2. 新しいGASプロジェクトが開きます
3. プロジェクト名を変更（例: "FX YouTube Analyzer"）

#### 2-3. コードのインポート
1. 既存の`Code.gs`ファイルの内容を全て削除
2. 提供された`fx_youtube_analyzer.gs`の内容を全てコピー&ペースト
3. ファイル名を`fx_youtube_analyzer.gs`に変更
4. **Ctrl+S**で保存

#### 2-4. Advanced Google Servicesの有効化
1. GASエディタの左側メニューで「**サービス**」（⚙️アイコン）をクリック
2. 「**+ サービスを追加**」をクリック  
3. 「YouTube Data API」を検索して選択
4. **バージョン**: 「v3」を選択
5. 「**追加**」をクリック

### Step 3: 初回実行・権限付与

#### 3-1. 初回実行
1. 関数選択ドロップダウンで「**onOpen**」を選択
2. 「**実行**」ボタンをクリック
3. 「**承認が必要**」ダイアログが表示されます

#### 3-2. 権限の付与
1. 「**権限を確認**」をクリック
2. Googleアカウントを選択
3. 「**このアプリは Google で確認されていません**」が表示された場合：
   - 「**詳細**」をクリック
   - 「**[プロジェクト名]（安全ではないページ）に移動**」をクリック
4. 「**許可**」をクリックして以下の権限を付与：
   - スプレッドシートの表示・編集・作成・削除
   - 外部サービスへの接続
   - スクリプトのWebアプリケーションとしての実行

#### 3-3. メニュー確認
1. スプレッドシートのタブに戻る
2. ページをリロード（F5）
3. メニューバーに「**🎯 YouTube分析 (日本FX特化)**」が表示されることを確認

## ⚙️ 初期設定

### Step 4: 初期セットアップ実行

#### 4-1. 自動セットアップ
1. メニュー「**🎯 YouTube分析 (日本FX特化)**」→「**🛠 初期セットアップ**」をクリック
2. 処理完了を待つ（数十秒）
3. 「初期セットアップ完了」のメッセージを確認

#### 4-2. 作成されるシート確認
以下のシートが自動作成されます：
- ✅ **検索語** - FXキーワード管理
- ✅ **チャンネル分析** - 発見・分析されたチャンネル情報
- ✅ **動画分析** - 動画の詳細データ  
- ✅ **コメント分析** - コメント感情分析結果
- ✅ **ダッシュボード** - 統計とグラフ
- ✅ **設定** - 各種設定値
- ✅ **ログ** - 実行履歴

### Step 5: APIキー設定

#### 5-1. YouTube Data API キー設定
1. メニュー「**🔧 設定**」をクリック
2. 「**YouTube API キー設定**」を選択
3. Step 1で取得したYouTube Data API v3キーを入力
4. 「OK」をクリック

#### 5-2. AI機能用APIキー設定（オプション）
1. 「**設定**」シートを開く
2. 以下のいずれかまたは両方を設定：
   - **ANTHROPIC_API_KEY** 行の「値」列にClaude APIキーを入力
   - **OPENAI_API_KEY** 行の「値」列にOpenAI APIキーを入力

#### 5-3. その他設定の調整（必要に応じて）
「設定」シートで以下の値を調整できます：

| 設定項目 | デフォルト値 | 説明 |
|---------|-------------|------|
| MAX_SEARCH | 500 | 最大発見チャンネル数 |
| MIN_SUBSCRIBERS | 1000 | 最小登録者数フィルター |
| REGION_CODE | JP | 検索地域コード |
| LANG | ja | 検索言語 |
| FX_THRESHOLD | 2 | FX関連度しきい値 |
| SIMPLE_MODE | OFF | 簡易モード初期設定 |

### Step 6: 検索語カスタマイズ（オプション）

#### 6-1. 基本検索語の確認
「**検索語**」シートには以下の15個の基本キーワードが設定済み：
```
FX, 為替, ドル円, USDJPY, EURJPY, GBPJPY, ポンド円, トレード, 
スキャルピング, デイトレード, テクニカル分析, 移動平均, RSI, 
MACD, ボリンジャー
```

#### 6-2. 追加キーワード設定
必要に応じて以下のようなキーワードを追加：
```
経済指標, ファンダメンタル分析, プライスアクション, ダウ理論,
エリオット波動, フィボナッチ, サポレジ, ロング, ショート, 
レバレッジ, 証拠金, スプレッド, スワップ, pips
```

## 🧪 動作確認・初回実行

### Step 7: 基本動作テスト

#### 7-1. チャンネル発見テスト
1. メニュー「**🔎 日本のFXチャンネル発見（1000人以上）**」をクリック
2. 処理完了まで待機（5-15分程度）
3. 「**チャンネル分析**」シートに結果が表示されることを確認
4. 以下を確認：
   - ✅ 登録者数1000人以上のチャンネルのみ
   - ✅ チャンネルURL列が正しく設定（@ハンドル優先）  
   - ✅ FX関連度が2以上のチャンネルのみ
   - ✅ 明らかに無関係なチャンネルが除外されている

#### 7-2. 包括分析テスト
1. メニュー「**▶️ 全て実行**」をクリック
2. 処理完了まで待機（10-30分程度）
3. 各シートにデータが入力されることを確認：
   - **チャンネル分析**: チャンネル詳細情報
   - **動画分析**: 動画別の詳細データ
   - **コメント分析**: コメントの感情分析結果

#### 7-3. ダッシュボード・グラフテスト
1. メニュー「**📊 ダッシュボード更新**」をクリック
2. 「**ダッシュボード**」シートを確認
3. 以下のグラフが生成されることを確認：
   - ✅ 上位20チャンネル - 登録者数（棒グラフ）
   - ✅ 上位20チャンネル - 平均再生回数（棒グラフ）
   - ✅ 上位20動画 - 再生回数（棒グラフ）
4. 統計情報が正しく表示されることを確認

### Step 8: AI機能テスト（APIキー設定時のみ）

#### 8-1. カスタム関数テスト
1. 「**ダッシュボード**」シートの空いているセルに以下を入力：
   ```
   =ASK_AI("上位チャンネルの特徴を要約してください")
   ```
2. Enterキーを押して実行
3. 日本語の要約が返されることを確認

#### 8-2. 範囲指定テスト
1. 別のセルに以下を入力：
   ```
   =ASK_AI("最も注目すべきチャンネルは？", チャンネル分析!A1:M20)
   ```
2. 特定の範囲を分析した結果が返されることを確認

#### 8-3. AI要約生成テスト
1. メニュー「**🤖 ダッシュボード要約（AI）**」をクリック  
2. ダッシュボードシートにAI要約が追加されることを確認

### Step 9: 簡易モードテスト

#### 9-1. モード切替テスト
1. 現在のシートタブ数を確認
2. メニュー「**🧭 簡易モード ON/OFF**」をクリック
3. 以下の6シートのみ表示されることを確認：
   - 検索語、チャンネル分析、動画分析、ダッシュボード、設定、ログ
4. 再度メニュー「**🧭 簡易モード ON/OFF**」をクリック
5. 全シートが表示に戻ることを確認

## ⚠️ トラブルシューティング

### よくある問題と解決方法

#### ❌ 「APIキーが設定されていません」エラー
**原因**: YouTube Data API キーが未設定
**解決方法**:
1. メニュー「🔧 設定」→「YouTube API キー設定」で設定
2. Google Cloud ConsoleでAPIキーが正しく生成されているか確認
3. APIキーにYouTube Data API v3へのアクセス権限があるか確認

#### ❌ 「承認が必要」が繰り返し表示される
**原因**: スクリプトの権限が適切に付与されていない
**解決方法**:
1. GASエディタで「実行」→権限の再付与を実行
2. すべての要求された権限を明示的に許可
3. ブラウザのクッキーとキャッシュをクリア後再試行

#### ❌ チャンネル発見で結果が少ない/0件
**原因**: 検索条件が厳しすぎる、またはAPI制限
**解決方法**:
1. 設定シートの`FX_THRESHOLD`を1に下げる
2. `MIN_SUBSCRIBERS`を500に下げる（テスト用）
3. 検索語シートに追加のキーワードを設定
4. Google Cloud ConsoleでAPI使用量を確認

#### ❌ AI機能が動作しない
**原因**: AIAPIキー未設定または無効
**解決方法**:
1. 設定シートでANTHROPIC_API_KEYまたはOPENAI_API_KEYを確認
2. APIキーが有効期限内で、クォータが残っているか確認
3. 外部APIへのアクセスがブロックされていないか確認

#### ❌ グラフが表示されない
**原因**: データ不足またはシート範囲エラー
**解決方法**:
1. チャンネル分析・動画分析にデータがあることを確認
2. ダッシュボード更新を再実行
3. 手動でEmbeddedChartの範囲を確認・修正

#### ❌ 処理が途中で停止する
**原因**: API制限またはタイムアウト
**解決方法**:
1. 設定シートのMAX_SEARCHを100-200に下げる
2. 時間を空けて再実行（APIクォータ復旧待ち）
3. 個別機能（チャンネル分析のみ等）から段階的に実行

### 📞 サポート・ログ確認

#### ログの確認方法
1. **ログ**シートで実行履歴とエラーを確認
2. GASエディタの「実行数」でスクリプト実行履歴を確認  
3. Google Cloud ConsoleのAPI使用量を確認

#### デバッグ情報の取得
1. ブラウザの開発者ツール（F12）でコンソールエラーを確認
2. GASエディタの実行ログを確認
3. API レスポンスの内容をログシートで確認

## 🎉 セットアップ完了

### 次のステップ
1. **日常運用**: 簡易モードONで必要な機能のみ使用
2. **定期実行**: 週次でチャンネル発見、日次で分析更新
3. **AI活用**: カスタム関数で柔軟な分析質問
4. **カスタマイズ**: 検索語・設定値の継続調整

### 推奨運用スケジュール
- **週1回**: 「🔎 日本のFXチャンネル発見」で新規チャンネル発見
- **2-3日に1回**: 「📺 チャンネル分析のみ」でメトリクス更新
- **週1回**: 「▶️ 全て実行」で包括分析
- **随時**: AI質問機能で柔軟な分析

おめでとうございます！🎊 
日本FX特化YouTube分析ツールのセットアップが完了しました。
効果的な分析とデータ活用をお楽しみください！