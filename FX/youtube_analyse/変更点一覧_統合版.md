# YouTube分析ツール - 日本FX特化統合版 変更点一覧

## 📋 概要
既存の「YouTube チャンネル分析ツール - 統合版」をベースとして、日本FX特化機能を統合・拡張した完全版を作成しました。

## 🆕 新規追加機能

### 1. 日本FX特化のチャンネル自動発見
**新規関数**:
- `discoverFxChannels()` - メイン発見機能
- `searchChannelsByTerm()` - 検索語ベースのチャンネル検索
- `calculateFxRelevanceForDiscovery()` - 発見時のFX関連度計算
- `getChannelRecentVideos()` - 最新動画取得（スコアリング用）
- `writeDiscoveredChannels()` - 発見結果のシート書き込み
- `generateChannelUrl()` - @ハンドル優先のURL生成

**機能特徴**:
- 登録者数1000人以上限定フィルタ
- 28種類のFXキーワードベーススコアリング
- 日本語判定によるスコア加点
- 英語主体チャンネルの減点
- 重複排除・ページネーション対応
- 設定可能な最大取得件数（デフォルト500件）

### 2. 初期セットアップ機能
**新規関数**:
- `initialSetup()` - 統合セットアップ機能
- `createRequiredSheets()` - 必要シート自動作成
- `setupInitialSettings()` - 初期設定値セット
- `setupInitialSearchTerms()` - 初期検索語セット

**自動作成要素**:
- 全必要シートの作成
- 初期設定値の配置
- 15個の基本FXキーワードプリセット

### 3. AI質問機能（自然言語Q&A）
**新規関数**:
- `ASK_AI()` - カスタム関数（スプレッドシート上で使用）
- `summarizeRangeData()` - 範囲データの統計要約
- `getDashboardSummary()` - ダッシュボード情報取得
- `callClaudeAPI()` - Anthropic Claude API呼び出し
- `callOpenAIAPI()` - OpenAI API呼び出し
- `generateAiSummary()` - ダッシュボード要約生成

**対応APIプロバイダー**:
- Anthropic Claude (claude-3-5-sonnet-20241022) - 優先
- OpenAI GPT (gpt-4) - 代替

### 4. 自動ダッシュボード・グラフ生成
**拡張関数**:
- `updateDashboard()` - 既存機能を大幅拡張
- `updateDashboardStats()` - 統計情報自動更新
- `createSubscriberChart()` - 上位20チャンネル登録者数グラフ
- `createAverageViewChart()` - 上位20チャンネル平均再生回数グラフ
- `createTopVideosChart()` - 上位20動画再生回数グラフ

**グラフ特徴**:
- EmbeddedChartBuilder使用
- 再実行時の重複防止
- 自動データソート・範囲設定
- 600x400pxの見やすいサイズ

### 5. 簡易モード機能
**新規関数**:
- `toggleSimpleMode()` - モード切り替え
- `enableSimpleMode()` - 簡易モード有効化
- `disableSimpleMode()` - 簡易モード無効化

**表示制限対象**（簡易モード時に表示）:
- 検索語、チャンネル分析、動画分析、ダッシュボード、設定、ログ

## 🔧 既存機能の拡張・改修

### 1. COLUMN_SCHEMASの拡張
**チャンネル分析スキーマ**（新順序）:
```javascript
['チャンネルID','チャンネル名','チャンネルURL','チャンネル説明',
 '登録者数','総動画数','総再生回数','平均再生回数',
 'チャンネル作成日','国','FX関連度','検証済み','分析日時']
```
- 「チャンネルURL」列を3番目に追加
- 「平均再生回数」列を追加（総再生回数/総動画数で算出）
- 「検証済み」列を追加（1000人以上で'はい'）

### 2. 分析機能の強化
**拡張関数**:
- `analyzeChannel()` - チャンネルURL生成、平均再生回数計算、検証ステータス追加
- `calculateFxRelevance()` - 既存機能の精度向上
- `updateChannelSheet()` - 新スキーマ対応

### 3. 設定管理の拡張
**新規設定項目**:
- `MAX_SEARCH` - 最大発見チャンネル数（デフォルト: 500）
- `MIN_SUBSCRIBERS` - 最小登録者数フィルター（デフォルト: 1000）
- `REGION_CODE` - 検索地域コード（デフォルト: JP）
- `LANG` - 検索言語（デフォルト: ja）
- `FX_THRESHOLD` - FX関連度しきい値（デフォルト: 2）
- `SIMPLE_MODE` - 簡易モード設定（デフォルト: OFF）
- `ANTHROPIC_API_KEY` - Claude APIキー
- `OPENAI_API_KEY` - OpenAI APIキー

## 📋 メニュー構成の拡張

### 新規メニュー項目
- 🛠 **初期セットアップ** → `initialSetup()`
- 🔎 **日本のFXチャンネル発見（1000人以上）** → `discoverFxChannels()`
- 🤖 **ダッシュボード要約（AI）** → `generateAiSummary()`
- 🧭 **簡易モード ON/OFF** → `toggleSimpleMode()`

### 既存メニュー項目（統合版から継承）
- ▶️ **全て実行** → `runAllAnalysis()`
- 📺 **チャンネル分析のみ** → `runChannelAnalysis()`
- 🎬 **動画分析のみ** → `runVideoAnalysis()`
- 💬 **コメント分析のみ** → `runCommentAnalysis()`
- 📊 **ダッシュボード更新** → `updateDashboard()`
- 🔧 **設定** → `openSettings()`
- 🗂 **シート管理** → `openDeletionManager()`
- ❓ **ヘルプ** → `showHelp()`

## 🌍 定数・設定の拡張

### FX_KEYWORDSの充実
```javascript
const FX_KEYWORDS = [
  // 基本用語（9個）
  'FX', '為替', 'ドル円', 'USDJPY', 'EURJPY', 'GBPJPY', 'ポンド円',
  // 取引手法（7個）
  'トレード', 'スキャルピング', 'スキャル', 'デイトレード', 'デイトレ', 
  'スイングトレード', 'ポジショントレード',
  // テクニカル分析（9個）
  'テクニカル分析', 'チャート分析', '移動平均線', '移動平均', 'RSI', 'MACD',
  'ボリンジャーバンド', 'ボリンジャー', 'フィボナッチ', 'フィボ',
  'サポートライン', 'レジスタンスライン', 'サポレジ',
  // 概念・理論（5個）
  'プライスアクション', 'ダウ理論', 'エリオット波動',
  '経済指標', 'ファンダメンタル分析', 'ファンダメンタルズ',
  // 実務用語（12個）
  'ロング', 'ショート', 'エントリー', 'エグジット', 'ストップロス',
  'テイクプロフィット', 'レバレッジ', '証拠金', 'スプレッド', 'スワップ',
  'pips', 'ピップス', '通貨ペア', '外国為替'
];
```

### SIMPLE_MODE_SHEETSの定義
```javascript
const SIMPLE_MODE_SHEETS = [
  '検索語', 'チャンネル分析', '動画分析', 'ダッシュボード', '設定', 'ログ'
];
```

### CONFIG.ANALYSISの拡張
```javascript
ANALYSIS: {
  MAX_CHANNELS: 500,
  MAX_VIDEOS_PER_CHANNEL: 50,
  MAX_COMMENTS_PER_VIDEO: 100,
  MIN_SUBSCRIBERS: 1000,               // 新規追加
  FX_RELEVANCE_THRESHOLD: 2,           // 新規追加
  REGION_CODE: 'JP',                   // 新規追加
  RELEVANCE_LANGUAGE: 'ja'             // 新規追加
}
```

## 🛠️ ユーティリティ機能の強化

### 新規ユーティリティ関数
- `getSearchTerms()` - 検索語シートからキーワード取得
- `getSetting(key)` / `setSetting(key, value)` - 設定シートアクセス
- `log(message)` - 統合ログ機能（コンソール + ログシート）

### UI機能の完全日本語化
- `showHelp()` - 日本語ヘルプの詳細化
- 全てのエラーメッセージ・成功メッセージの日本語化
- AI機能の使用方法をヘルプに追加

## 🔄 既存機能の互換性保持

### 完全継承された既存機能
- `runAllAnalysis()` - 全体分析フロー
- `runChannelAnalysis()` - 個別チャンネル分析
- `runVideoAnalysis()` - 動画分析
- `runCommentAnalysis()` - コメント分析
- API関連機能（`makeApiRequest`等）
- シート操作機能（`getOrCreateSheet`等）
- 分析アルゴリズム（感情分析・キーワード抽出等）

### 機能向上した既存機能
- `analyzeChannel()` - 新スキーマ対応、URL生成追加
- `updateDashboard()` - グラフ自動生成機能追加
- エラーハンドリングの強化
- API制限対応の改善

## 📊 新しいデータフロー

### 典型的な使用フロー
1. `initialSetup()` - 初期環境構築
2. APIキー設定（YouTube + AI）
3. `discoverFxChannels()` - FXチャンネル自動発見
4. `runAllAnalysis()` - 包括分析実行
5. `updateDashboard()` - グラフ付きダッシュボード生成
6. `generateAiSummary()` - AI要約生成
7. 簡易モード適用で日常運用

### AI活用の典型例
```javascript
=ASK_AI("上位チャンネルの特徴は？")
=ASK_AI("最も伸びているチャンネルは？", チャンネル分析!A1:M20)
=ASK_AI("動画の傾向を分析して", 動画分析!A1:N100)
```

## 🎯 新機能の受け入れ基準達成状況

| 要件 | 実装状況 | 対応機能 |
|------|---------|----------|
| 日本FXチャンネル自動発見（1000人以上） | ✅ | `discoverFxChannels()` |
| チャンネルURL列追加（@ハンドル優先） | ✅ | `generateChannelUrl()` |
| FX関連度によるフィルタリング | ✅ | `calculateFxRelevanceForDiscovery()` |
| 自動ダッシュボードグラフ生成 | ✅ | 3種グラフ自動生成・重複防止 |
| 簡易モード機能 | ✅ | `toggleSimpleMode()` |
| AI質問機能 | ✅ | `ASK_AI()` カスタム関数 |
| 全日本語対応 | ✅ | 全UI・メッセージ・ヘルプ |
| 既存機能の完全継承 | ✅ | 統合版の全機能維持 |

## 📈 パフォーマンス・安定性の向上

### API制限対策
- 指数バックオフによるリトライ機能
- 1000ms間隔での処理待機
- API使用量の記録・監視

### エラーハンドリング強化
- 全関数でのtry-catch実装
- ユーザー向けエラーメッセージの日本語化
- ログシートでの詳細履歴記録

### メモリ・処理効率化
- Map利用による重複排除
- ページネーション対応
- 大量データ処理時の分割実行

この統合版により、既存の分析機能を維持しながら、日本のFX市場に特化した強力なチャンネル発見・分析システムが実現されました。