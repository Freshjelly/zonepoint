# 日本FX特化YouTube分析システム - セットアップガイド

## 🎯 概要
このシステムは、日本のFX関連YouTubeチャンネルを自動発見・分析し、ダッシュボード形式で可視化するGoogle Apps Script（GAS）アプリケーションです。

## 📋 必要な権限・準備

### 1. Google Cloud Platform設定
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成（または既存プロジェクトを選択）
3. **APIs & Services** → **Library** で以下のAPIを有効化：
   - ✅ **YouTube Data API v3**
   - ✅ **Google Sheets API**（通常は自動で有効）

### 2. APIキーの取得
1. Google Cloud Console → **APIs & Services** → **Credentials**
2. **+ CREATE CREDENTIALS** → **API key** をクリック
3. 作成されたAPIキーをコピー（後で使用）
4. **Edit API key** で以下の制限を設定（推奨）：
   - **Application restrictions**: None（または適切なHTTPリファラー）
   - **API restrictions**: YouTube Data API v3のみを選択

### 3. Advanced Google Services設定
1. Google Apps Script エディタを開く
2. 左側のメニューで **Services** （⚙️アイコン）をクリック
3. **+ Add a service** をクリック
4. **YouTube Data API** を検索して選択
5. **Version**: v3を選択
6. **Add** をクリック

### 4. AI機能用APIキー取得（オプション）
AI質問機能を使用する場合は、以下のいずれかのAPIキーを取得：

#### Anthropic Claude API（推奨）
1. [Anthropic Console](https://console.anthropic.com/) でアカウント作成
2. APIキーを生成してコピー

#### OpenAI API（代替）
1. [OpenAI Platform](https://platform.openai.com/) でアカウント作成
2. APIキーを生成してコピー

## 🚀 インストール手順

### Step 1: Googleスプレッドシート作成
1. [Google Sheets](https://sheets.google.com/) で新しいスプレッドシートを作成
2. ファイル名を「日本FX YouTube分析」などに変更

### Step 2: Google Apps Script設定
1. スプレッドシートで **Extensions** → **Apps Script** をクリック
2. 新しいGASプロジェクトが開きます
3. 既存の `Code.gs` ファイルの内容を全て削除
4. `analysegas.gs` ファイルの内容を全てコピー&ペースト
5. ファイル名を `analysegas.gs` に変更
6. **Save** (Ctrl+S) で保存

### Step 3: 初回実行・権限付与
1. 上部の関数選択で **onOpen** を選択
2. **Run** ボタンをクリック
3. 権限確認ダイアログが表示されます：
   - **Review permissions** をクリック
   - Googleアカウントを選択
   - **Advanced** → **Go to [プロジェクト名] (unsafe)** をクリック
   - **Allow** をクリックして権限を付与

### Step 4: スプレッドシートに戻ってメニュー確認
1. スプレッドシートのタブに戻る
2. 画面をリロード（F5）
3. メニューバーに **🎯 日本FX YouTube分析** が表示されることを確認

## ⚙️ 基本設定

### 1. APIキー設定
1. **設定** シートを開く
2. **APIKEY** 行の「値」列に YouTube Data API v3 キーを入力
3. （オプション）**ANTHROPIC_API_KEY** 行にClaude APIキーを入力
4. （オプション）**OPENAI_API_KEY** 行にOpenAI APIキーを入力

### 2. 動作設定の調整（必要に応じて）
| 設定項目 | デフォルト値 | 説明 |
|---------|--------------|------|
| MAX_CHANNELS | 500 | 最大取得チャンネル数 |
| MIN_SUBSCRIBERS | 1000 | 最小登録者数フィルター |
| FX_SCORE_THRESHOLD | 2 | FX関連判定しきい値 |
| SIMPLE_MODE | ON | 簡易モード（ON/OFF） |

### 3. 環境診断の実行
1. メニュー **環境診断（Health Check）** を実行
2. 全ての項目が✅になることを確認
3. ❌がある場合は該当する設定を見直し

## 🎬 初回実行手順

### Phase 1: 基本設定
1. **検索語** シートで使用するFXキーワードを確認・調整
2. 必要に応じて追加のキーワードを入力

### Phase 2: チャンネル発見
1. メニュー **1. 競合発見（日本FX特化）** を実行
2. 処理完了を待つ（5-15分程度、検索語とAPI制限による）
3. **発見チャンネル** シートに結果が表示されることを確認

### Phase 3: 分析対象選定
1. メニュー **2b. 人気順で抽出** を実行
2. **分析対象チャンネル** シートに上位20チャンネルが設定されることを確認

### Phase 4: 詳細データ取得
1. メニュー **3. メトリクス取得（低負荷）** を実行
2. メニュー **4. 詳細動画一覧更新** を実行
3. メニュー **5. 日次スナップショット** を実行

### Phase 5: ダッシュボード生成
1. メニュー **9. ダッシュボード初期化** を実行
2. **ダッシュボード** シートでグラフが表示されることを確認

### Phase 6: AI機能テスト（APIキー設定済みの場合）
1. メニュー **AIに要約してもらう（ダッシュボード）** を実行
2. AI要約が生成されることを確認

## 🔧 定期実行の設定

### 自動トリガーの設定
1. GASエディタで **Triggers**（⏰アイコン）をクリック
2. **+ Add Trigger** をクリック
3. 以下の2つのトリガーを設定：

#### 日次更新トリガー
- **Choose which function to run**: `snapshotPublicMetrics`
- **Select event source**: Time-driven
- **Select type of time based trigger**: Day timer
- **Select time of day**: 9am to 10am

#### 週次発見トリガー
- **Choose which function to run**: `discoverChannels`
- **Select event source**: Time-driven
- **Select type of time based trigger**: Week timer
- **Select day of week**: Monday
- **Select time of day**: 10am to 11am

## 📱 使用方法

### 日常的な操作
1. **簡易モード** で必要なシートのみ表示
2. **ダッシュボード** で全体状況を把握
3. **発見チャンネル** で新しいチャンネルをチェック
4. AI機能で分析結果を自然言語で質問

### データ更新
- **低負荷更新**: メニュー「3. メトリクス取得（低負荷）」
- **完全更新**: メニュー「2a. 全取得チャンネル詳細更新」
- **新チャンネル発見**: メニュー「1. 競合発見（日本FX特化）」

### AI活用例
```
=ASK_AI("最も成長しているチャンネルは？")
=ASK_AI("投稿頻度の高いチャンネルの特徴は？")
=ASK_AI("登録者数と再生数の関係を分析して")
```

## ⚠️ 注意点・制約

### APIクォータ制限
- YouTube Data API v3は1日10,000ユニットまで
- 大量のチャンネル処理時は複数日に分けて実行
- エラー時は自動でリトライするため時間がかかる場合あり

### データ精度
- チャンネルの国判定は完全ではない
- FX関連性の判定はキーワードベースのため誤検出の可能性
- 非公開チャンネルや削除チャンネルは除外される

### パフォーマンス
- 初回実行は時間がかかります（10-30分）
- 定期実行設定により負荷を分散することを推奨

## 🆘 トラブルシューティング

### よくある問題

#### 1. 「競合発見」でエラーが発生
**原因**: APIキー未設定またはクォータ超過
**解決方法**:
- 設定シートのAPIKEYを確認
- Google Cloud ConsoleでAPIクォータ確認
- Advanced ServicesでYouTube Data API v3が有効か確認

#### 2. グラフが表示されない
**原因**: データ不足または範囲エラー
**解決方法**:
- 発見チャンネルにデータがあることを確認
- ダッシュボード再生成を実行
- 手動でグラフ範囲を調整

#### 3. AI機能が動作しない
**原因**: APIキー未設定または外部API制限
**解決方法**:
- 設定シートのAI APIキーを確認
- APIキーの有効性とクォータを確認
- UrlFetchAppの権限を確認

#### 4. 簡易モードが動作しない
**原因**: 権限不足またはスクリプトエラー
**解決方法**:
- スクリプトの実行権限を確認
- エラーログを確認
- 手動でシートの表示/非表示を調整

### エラーログの確認
1. **ログ** シートでシステムログを確認
2. GASエディタの **Executions** でスクリプト実行履歴を確認
3. メニュー「環境診断」で設定状況を確認

### サポート情報
- **ログシート**: 全ての処理履歴とエラー情報
- **環境診断**: 設定状況とAPI接続状況
- **テスト手順書**: 系統的な動作確認方法

## 🔄 アップデート・保守

### 定期メンテナンス
- 月1回：発見チャンネルの精査とクリーンアップ
- 週1回：分析対象チャンネルの見直し
- 日次：ログの確認とエラー対応

### データバックアップ
- 重要なデータはスプレッドシートのコピーで保管
- 設定値は別途記録しておくことを推奨

### カスタマイズ
- FXキーワードは「検索語」シートで自由に追加・削除
- 各種しきい値は「設定」シートで調整可能
- グラフの種類やレイアウトはコード修正で変更可能

---

🎉 **セットアップ完了！**
これで日本FX特化YouTube分析システムが使用可能になりました。
初回は「0. 初期セットアップガイド」メニューで手順を再確認し、段階的に機能をテストしてください。